<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Minha extensão</title>
    <script src="https://cdn.jsdelivr.net/npm/@tarkenag/tex-extension-helper@3/lib/tex-helper.js"></script>
  <style>
  body {
    border-style: solid;
    border-color: red;
    min-height: fit-content;
  }
  </style>
  </head>
  <body>
    <div>
      <h1 id="waiting_auth">Esperando autenticação...</h1>
      <h1 id="waiting_context">Esperando contexto...</h1>

      <h1>Hello world!</h1>
      <h3 id='h3'></h3>
      <pre id="context-slot"></pre>
      <div>
Etiam laoreet arcu lobortis nulla ultricies convallis. Phasellus non justo quis urna sollicitudin venenatis. Donec sed semper nisi. Praesent sed lacus sed justo vulputate dictum et ut turpis. Ut in tellus laoreet, malesuada metus non, mollis neque. Proin a condimentum ex. Maecenas tempus, arcu at condimentum pharetra, neque libero tincidunt neque, id pharetra nibh magna vitae quam. Sed placerat porttitor condimentum. Sed scelerisque porta augue eget tempus. Nullam sit amet leo lacinia diam commodo bibendum.
     </div>
     </div>
    </div>
    <script type="module">
      const waitingAuth$ = document.getElementById('waiting_auth')
      const waitingContext$ = document.getElementById('waiting_context')
      const h3$ = document.getElementById('h3')
      const contextSlot$ = document.getElementById('context-slot')

      const urlParams = new URLSearchParams(window.location.search);
      const a = urlParams.get('a') || undefined
      const b = urlParams.get('b') || undefined

      if (a) {
        h3$.innerText = `A: ${a}`;
      }
      if (b) {
        h3$.innerText = `B: ${b}`;
      }

      window.Tarken.tex.onAuthorized(
        function onAuthorizedEventHandler(data) {
          waitingAuth$.remove()
          document.body.style.borderColor= "green"
          //console.debug('authz dentro da extensão: ', data)
          document.body.style.borderColor= "green"
        }
      )

      window.Tarken.tex.onContext(
        function onContextEventHandler(data) {
          waitingContext$.remove()
          //console.debug('contexto dentro da extensão: ', data)
          document.body.style.borderColor= "blue"

          contextSlot$.innerHTML = JSON.stringify(data, null, 2)
        }
      )

      window.Tarken.tex.listen({
        contentSize: () => ({
          width: document.documentElement.offsetWidth,
          height: document.documentElement.offsetHeight,
        }),
      })
    </script>
  </body>
</html>
